package utils

import (
	"bytes"
	"crypto/rand"
	"os"
	"path"
	"strings"
	"testing"
)

func TestGenerateMsg(t *testing.T) {
	enc_kek := "86181ec47326d750d78e8432722a249975571dab4bf657f7cca4026789c74a7e7534b267504066657b5dd7cac6adf077e6630c6461a6950917cb282bbe209a407921ad40f3f6d3cc13d40407674753b7b4605bf081859fe116bf6e539d261c118e40a36ce47d8de0b73283b95803da4980d182ad99fa34aaae857b8358f274f548fa764272a7713e8e0ce21766bc3433c5fb771058e4371407d98f849c79b1005f8412f39a2aedacaf8dfc5fed097f2ecd3c073dbf91ea5d804a3c795d211d108ca4d4d9b76f11375eda131ed5a17ebd3fa53b14e91d35a73ad7922872427ecf6ac1a950cbf67db179f4fbb41cf4a33b0f47e8ecaba6dcd39b1f124dd2ef48d51e2ae52da5c6e61cafe1aaea8fedd8276c6ff7f756375bca178940d25146f5289693b03517089bafb905d23b95ba33941e3038a3acbb1738c2c8cfbf84ff307cbba3a4016b340ffde32288a1cf442bd033d172fed11c803e399a49d2af621676b67cdd52a5cefc5f3699e715021849b6427a1f2c6c53de6ce9800ea942877781e599b23175cf417c46b39b1e6f32abceb3d6d5d7f819705756b5c9627665d2fe6a8c5a9213ce423aecaccb27df2a5a6505e1f45e6ac594da64c9e335b935c67ba8497070b3050394f2fc0a9fba19b72ab601a4a391854f1f452e14f6c14957cadb0db62bdd6b92388ab81e9f01205fad72437b09faf2ed38d6bfd86f650fa306b5cb99502e4d7e0e044d67215020eced9aeff6b680f02e9589abdaaa4ced30be2e517c685110f5f28913c819ac354c4c541e7e61554b52ab8bd6e0a5aa653c48155232a28ca26bb3884b93c290d62c19042711258d19c721d267a3b112fb30407cd6dc336d5890dc6db9980b0c63e264da1b28004bc4bbc07f8b64e7aabf9488628e4917534355d1fa49d2dc8437a639dda25d0e14499d37e7482bb84fb49d83fd037aea9facfe6d56374b71eb7a6b715d13cc80d2ab928e3b4a3222e7a27bdcb2d501532a3a9531fe6c9689e165a27b31802651b4098aeaacd34847a309abab07c1c69ef64892d8ff997444021dcb634f55184244551cc8c5abab08b20beec6f7360028166e3bd43b5936dd731ff1f1b33010a9d8e394f732b60dff855ab396215d5322f0cb88f2154e2b1aae263e63771027687d3098348702b4704be3f2e6fe6b14f3632b53ab28a852db317a190aca29e79a61d01c598723496ba5c0f62f616fe11abc3ffac21e20e297693e6fdf48e19463aa6646593cc22233bff94a3e064ffb4ea6ba129fb5acf75d5419c45d8c563a08c7ad224439edfd647cadec225ea5f3a2e9c56e817ac09440f94201adff7b192e9023789fbc01f81e81a1e5348a826a31ec144d8bf4741c7fcf239b32980c8bec8b52b74ead31107e913d7fada6bf4b03cb54c192f570dfef2a56ffe0a4b11bdc0e885c8d14a95011e4590667a88b608a2d219c85112d3da2e90f1a96ddadb1b19c07aa2cab9fc8bd766e910e52b2b71dc94be193d06fa65885e581e91875d407933ce8765454d0b005cb125911c476a7120158790fa495ca3e5cacea6efd5cb1e0294459d271f11a22933b21a775d6b1709ac3e92156d3a00d6d74d9280bc4c1d807f3b699a73e3de98c85f6db22836a1d99d56a639b726b72451e94957553b3fcdbdd9be4bacef4ddbe7701054b38f45ccd37387d58b4e05b5e5fa1d124a0a7c8295e01fc9fd050104e8a6cbba5b61d2930fd999e78a20bdf82a060a8f5253e3945036904a97ff47dfe9abb257f09e2e11aa1fc398825c5c7ce390a60862044158a2119b4fa87be37343df4ba745f326b88ff0123dd37c33061c0df59644c45ca3362191c4814b6dd6c5941a1f1b2bd27f70e4f4640d4837c706595f206629e9ab1828711a07910869a80b58c44cc396fa3d016a757b12f48ecbe8a9d7d77a9e941ef4f387cd3b898e7ebce6e47b0c2fde0ea3ee6e335613e6d18a57dd9848b92f227dcfc120677b220ed696c81120984c482fb6369eaabd3c4e4774465edaa0c5d16eeede730cb1f6158d098e1f7c1215beb021eba4b7ba5688dfcce48518ce2541e927626e4ba2bf5719ca93a54e7b2a362a55c26c4b0ab343cdc481694cf90a861bf4b4eef9cc8a8c34f231d7e3ff3700abfa32dca9a9c1c6f4acf17f31b6a38a453a74a7ec2c549cd46c541bd6dd5c515845f23272462eb2bbe6cec5dcaf85b9c66b0b0e9ac141ea113f280db2eba8ee53e7e5e788d5070b58284223ad114dd8d6f42967536057fd96d031d1d59792c8eb6696e89748f83cd346290556d77e243c8dc193713d6203916be011c659638c91155d4f6e27b77cdc98d437d83b7e54bb30e78e6ca00e3ae5c93582c01de2663c98224953a076b70436777603122f0ce00ded6dda1467b38b275f0d7a04bc8595e1eaefad02016534d8240c242502406489e7c9794056d0bab735050a892eae3cf91b01cac66185ccdb0bce51adc4ab652b36258ecdf58f7aa33913b06befb8aff29c350488e4d6cfa9486ced885cc45a8c6d00862e5f81ee3f40d33cfb92f83981717e0ac4b972090158a406c5cb874943d1cc7901ec4b12d078046ebb9a277bc85b90dcf782d5e349bf9563f2d6869cdb0d3ae74effec2dfade876455a7254a1edcdb020865aa9421a6fd8a5e8f3f755ed7285212da8e59b58c54daf24f4aa8717a9287921471a5340fadc7447615a51920472695b438ce7dc1e1ebafe6f1408c4936dd1a3ee20897b687ed621915ae48f777bedc150d077bddaf3c40699c3119a112a93f29a433608ea00a9025aa411f39b0cb112aadc93042468a70f9c8f8f9d63dbf69ff9c1e85bb4e90af63f00e047fb91963e24f7f761e5700849bb2ae3d5c92204f8bc148fe7e47caf54429e060a45dcfea49838797947e9cd6b49346616ba71d3f2e41a656e67368193e3d6ffb58b109876d54e9f7e34efe62476d79b8bf7111a5ba5476641f12010db54943ba191b70b4ffb26cbdcd4957a36c3c4132e113380c3ef0e22991d6e542af059cc6376193c1140736f955a17c830f8c93a4f9cd62b158e05118c0c628621f5138d19293c59559bd01955f57a6b9755533adddea8a12186cfb999f81b22e352e27b0b71fdfa9229a7c22e2a4e15e52c5d587d5717d50623e9f827174e1d374aafebb13d2d7cf8678e9b81afc82e9e0b68204ac92baf6b46befdeeccc33138f43b0f3993cab74b7aee686ee63ef023f7723f00c2080bcef423cc7654e70a00cc9d86514d9fef5d23bc1e6aed2b4c76c71d301fd7578bcf33224386d3901f8081a4c2df79c8ee1b9e44bf654cc0915fc043eb3a7a5992a7e7bfb6f978a30e294d17743b7a82f2041ac808aa058d6d5f264ee38a2cb916bd50190f04cb74466be51518482743aa53955ae8b49c373de8f450ac73069e567b214b47ad15ac72eee68dfbcf752219a2e76d580b2b0e8f2cb1f0abc256097a2d654ecc1991ff3579c3c6bd18d315d46be942dd4aceca24d0cc28208604a71e3e445dec7cd2e45d2fb769493a12a57132b138d5309e58332b99e25f9711a3250d6a6c8fbc62bcb4cd14b9f41e47960499ac9e95ae809785631fb8860d0f2b25a162d356e037180ae72b375ab349f88f0f915709ee349483f77dc01a5eb0fb449265f1f3aba70cfa16d1be3a6c8a76f00813b02b0cb8c4165e1e1fcb712b830384534967f4a72bdf83b05384033eee93a497497a276ad3b42e349a0b06409eed96158a3affbbdae4b56f5a3932bdf2decca8f933b98ce47f0070712820fe1c3cf656cff93879bf0affb6f59377326ff0014c4eebec98eec3f6ef2c82d59c126871850f6eb04b6052864d331900ea665826c7776f5631c38b5df87486881b3bc0fce7401d1ec01bca5403684ac7af2f01e079d9c4e2c354a9b1a7eec7962720f344f426fd1f114a344501843f714b58b627727aa01872518fc5c0e573f1d7b54a1689fa276a16edf162a8788778df61bfc16b29078762b5b63e0daeb0936413184809742c6099a3ef1638bd08188ed9735c397e7f465a8e3d8d8cb050ab46304296cbf2cac325ca58b4ad44c9d01fd75ae6c5737d7d41022437c08d8f72106e2f58ec68d6cae2ff727455733a1247a7450c202b96a8606bbb0bb2a716a023efba65f7ce71c7c4916791271d8aba113d0a9b73ed7a4f53cf289a55873e79c3afbe2fd7e5dadff26a20fe212eec069ab4082c6db24abb11df7b192dd8faa2c65a362299bc7f9ca6460986a2a5e6bd9aad923be66a59924e97c3a755dfe6bc9f1ef5faceeea7fd8c012ef08cb186bd36c1800cdb95ef3c3d6c12f18a43f7d5054fa0db4192e0cf1022cd717f34d5d53a4acfc69f5219"
	msg := GenerateMsg("test@mail.com", enc_kek)

	if !strings.Contains(string(msg), "test@mail.com") || !strings.Contains(string(msg), enc_kek) {
		t.Errorf("Failed to decrypt data")
	}
}

func TestAddMsgToFileSmall(t *testing.T) {
	enc_kek := "86181ec47326d750d78e8432722a249975571dab4bf657f7cca4026789c74a7e7534b267504066657b5dd7cac6adf077e6630c6461a6950917cb282bbe209a407921ad40f3f6d3cc13d40407674753b7b4605bf081859fe116bf6e539d261c118e40a36ce47d8de0b73283b95803da4980d182ad99fa34aaae857b8358f274f548fa764272a7713e8e0ce21766bc3433c5fb771058e4371407d98f849c79b1005f8412f39a2aedacaf8dfc5fed097f2ecd3c073dbf91ea5d804a3c795d211d108ca4d4d9b76f11375eda131ed5a17ebd3fa53b14e91d35a73ad7922872427ecf6ac1a950cbf67db179f4fbb41cf4a33b0f47e8ecaba6dcd39b1f124dd2ef48d51e2ae52da5c6e61cafe1aaea8fedd8276c6ff7f756375bca178940d25146f5289693b03517089bafb905d23b95ba33941e3038a3acbb1738c2c8cfbf84ff307cbba3a4016b340ffde32288a1cf442bd033d172fed11c803e399a49d2af621676b67cdd52a5cefc5f3699e715021849b6427a1f2c6c53de6ce9800ea942877781e599b23175cf417c46b39b1e6f32abceb3d6d5d7f819705756b5c9627665d2fe6a8c5a9213ce423aecaccb27df2a5a6505e1f45e6ac594da64c9e335b935c67ba8497070b3050394f2fc0a9fba19b72ab601a4a391854f1f452e14f6c14957cadb0db62bdd6b92388ab81e9f01205fad72437b09faf2ed38d6bfd86f650fa306b5cb99502e4d7e0e044d67215020eced9aeff6b680f02e9589abdaaa4ced30be2e517c685110f5f28913c819ac354c4c541e7e61554b52ab8bd6e0a5aa653c48155232a28ca26bb3884b93c290d62c19042711258d19c721d267a3b112fb30407cd6dc336d5890dc6db9980b0c63e264da1b28004bc4bbc07f8b64e7aabf9488628e4917534355d1fa49d2dc8437a639dda25d0e14499d37e7482bb84fb49d83fd037aea9facfe6d56374b71eb7a6b715d13cc80d2ab928e3b4a3222e7a27bdcb2d501532a3a9531fe6c9689e165a27b31802651b4098aeaacd34847a309abab07c1c69ef64892d8ff997444021dcb634f55184244551cc8c5abab08b20beec6f7360028166e3bd43b5936dd731ff1f1b33010a9d8e394f732b60dff855ab396215d5322f0cb88f2154e2b1aae263e63771027687d3098348702b4704be3f2e6fe6b14f3632b53ab28a852db317a190aca29e79a61d01c598723496ba5c0f62f616fe11abc3ffac21e20e297693e6fdf48e19463aa6646593cc22233bff94a3e064ffb4ea6ba129fb5acf75d5419c45d8c563a08c7ad224439edfd647cadec225ea5f3a2e9c56e817ac09440f94201adff7b192e9023789fbc01f81e81a1e5348a826a31ec144d8bf4741c7fcf239b32980c8bec8b52b74ead31107e913d7fada6bf4b03cb54c192f570dfef2a56ffe0a4b11bdc0e885c8d14a95011e4590667a88b608a2d219c85112d3da2e90f1a96ddadb1b19c07aa2cab9fc8bd766e910e52b2b71dc94be193d06fa65885e581e91875d407933ce8765454d0b005cb125911c476a7120158790fa495ca3e5cacea6efd5cb1e0294459d271f11a22933b21a775d6b1709ac3e92156d3a00d6d74d9280bc4c1d807f3b699a73e3de98c85f6db22836a1d99d56a639b726b72451e94957553b3fcdbdd9be4bacef4ddbe7701054b38f45ccd37387d58b4e05b5e5fa1d124a0a7c8295e01fc9fd050104e8a6cbba5b61d2930fd999e78a20bdf82a060a8f5253e3945036904a97ff47dfe9abb257f09e2e11aa1fc398825c5c7ce390a60862044158a2119b4fa87be37343df4ba745f326b88ff0123dd37c33061c0df59644c45ca3362191c4814b6dd6c5941a1f1b2bd27f70e4f4640d4837c706595f206629e9ab1828711a07910869a80b58c44cc396fa3d016a757b12f48ecbe8a9d7d77a9e941ef4f387cd3b898e7ebce6e47b0c2fde0ea3ee6e335613e6d18a57dd9848b92f227dcfc120677b220ed696c81120984c482fb6369eaabd3c4e4774465edaa0c5d16eeede730cb1f6158d098e1f7c1215beb021eba4b7ba5688dfcce48518ce2541e927626e4ba2bf5719ca93a54e7b2a362a55c26c4b0ab343cdc481694cf90a861bf4b4eef9cc8a8c34f231d7e3ff3700abfa32dca9a9c1c6f4acf17f31b6a38a453a74a7ec2c549cd46c541bd6dd5c515845f23272462eb2bbe6cec5dcaf85b9c66b0b0e9ac141ea113f280db2eba8ee53e7e5e788d5070b58284223ad114dd8d6f42967536057fd96d031d1d59792c8eb6696e89748f83cd346290556d77e243c8dc193713d6203916be011c659638c91155d4f6e27b77cdc98d437d83b7e54bb30e78e6ca00e3ae5c93582c01de2663c98224953a076b70436777603122f0ce00ded6dda1467b38b275f0d7a04bc8595e1eaefad02016534d8240c242502406489e7c9794056d0bab735050a892eae3cf91b01cac66185ccdb0bce51adc4ab652b36258ecdf58f7aa33913b06befb8aff29c350488e4d6cfa9486ced885cc45a8c6d00862e5f81ee3f40d33cfb92f83981717e0ac4b972090158a406c5cb874943d1cc7901ec4b12d078046ebb9a277bc85b90dcf782d5e349bf9563f2d6869cdb0d3ae74effec2dfade876455a7254a1edcdb020865aa9421a6fd8a5e8f3f755ed7285212da8e59b58c54daf24f4aa8717a9287921471a5340fadc7447615a51920472695b438ce7dc1e1ebafe6f1408c4936dd1a3ee20897b687ed621915ae48f777bedc150d077bddaf3c40699c3119a112a93f29a433608ea00a9025aa411f39b0cb112aadc93042468a70f9c8f8f9d63dbf69ff9c1e85bb4e90af63f00e047fb91963e24f7f761e5700849bb2ae3d5c92204f8bc148fe7e47caf54429e060a45dcfea49838797947e9cd6b49346616ba71d3f2e41a656e67368193e3d6ffb58b109876d54e9f7e34efe62476d79b8bf7111a5ba5476641f12010db54943ba191b70b4ffb26cbdcd4957a36c3c4132e113380c3ef0e22991d6e542af059cc6376193c1140736f955a17c830f8c93a4f9cd62b158e05118c0c628621f5138d19293c59559bd01955f57a6b9755533adddea8a12186cfb999f81b22e352e27b0b71fdfa9229a7c22e2a4e15e52c5d587d5717d50623e9f827174e1d374aafebb13d2d7cf8678e9b81afc82e9e0b68204ac92baf6b46befdeeccc33138f43b0f3993cab74b7aee686ee63ef023f7723f00c2080bcef423cc7654e70a00cc9d86514d9fef5d23bc1e6aed2b4c76c71d301fd7578bcf33224386d3901f8081a4c2df79c8ee1b9e44bf654cc0915fc043eb3a7a5992a7e7bfb6f978a30e294d17743b7a82f2041ac808aa058d6d5f264ee38a2cb916bd50190f04cb74466be51518482743aa53955ae8b49c373de8f450ac73069e567b214b47ad15ac72eee68dfbcf752219a2e76d580b2b0e8f2cb1f0abc256097a2d654ecc1991ff3579c3c6bd18d315d46be942dd4aceca24d0cc28208604a71e3e445dec7cd2e45d2fb769493a12a57132b138d5309e58332b99e25f9711a3250d6a6c8fbc62bcb4cd14b9f41e47960499ac9e95ae809785631fb8860d0f2b25a162d356e037180ae72b375ab349f88f0f915709ee349483f77dc01a5eb0fb449265f1f3aba70cfa16d1be3a6c8a76f00813b02b0cb8c4165e1e1fcb712b830384534967f4a72bdf83b05384033eee93a497497a276ad3b42e349a0b06409eed96158a3affbbdae4b56f5a3932bdf2decca8f933b98ce47f0070712820fe1c3cf656cff93879bf0affb6f59377326ff0014c4eebec98eec3f6ef2c82d59c126871850f6eb04b6052864d331900ea665826c7776f5631c38b5df87486881b3bc0fce7401d1ec01bca5403684ac7af2f01e079d9c4e2c354a9b1a7eec7962720f344f426fd1f114a344501843f714b58b627727aa01872518fc5c0e573f1d7b54a1689fa276a16edf162a8788778df61bfc16b29078762b5b63e0daeb0936413184809742c6099a3ef1638bd08188ed9735c397e7f465a8e3d8d8cb050ab46304296cbf2cac325ca58b4ad44c9d01fd75ae6c5737d7d41022437c08d8f72106e2f58ec68d6cae2ff727455733a1247a7450c202b96a8606bbb0bb2a716a023efba65f7ce71c7c4916791271d8aba113d0a9b73ed7a4f53cf289a55873e79c3afbe2fd7e5dadff26a20fe212eec069ab4082c6db24abb11df7b192dd8faa2c65a362299bc7f9ca6460986a2a5e6bd9aad923be66a59924e97c3a755dfe6bc9f1ef5faceeea7fd8c012ef08cb186bd36c1800cdb95ef3c3d6c12f18a43f7d5054fa0db4192e0cf1022cd717f34d5d53a4acfc69f5219"
	tempdir, _ := os.MkdirTemp("", "sampledir")
	defer os.RemoveAll(tempdir)
	filename := path.Join(tempdir, "my_file.txt")
	os.WriteFile(filename, []byte("The quick brown fox jumps over the lazy dog"), 0644)

	AddMsgToFile(filename, "test@mail.com", enc_kek)
	StripMsgToFile(filename)

	data, _ := os.ReadFile(filename)

	if string(data) != "The quick brown fox jumps over the lazy dog" {
		t.Errorf("Failed to strip msg from data")
	}

	data = make([]byte, 1024*1024*10)
	rand.Read(data)
	os.WriteFile(filename, data, 0644)
	AddMsgToFile(filename, "test@mail.com", enc_kek)

	StripMsgToFile(filename)
	data2, _ := os.ReadFile(filename)
	if !bytes.Equal(data, data2) {
		t.Errorf("Failed to strip msg from data")
	}
}
